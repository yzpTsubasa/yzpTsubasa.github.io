window.__require=function t(e,o,n){function r(c,a){if(!o[c]){if(!e[c]){var s=c.split("/");if(s=s[s.length-1],!e[s]){var p="function"==typeof __require&&__require;if(!a&&p)return p(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+c+"'")}c=s}var u=o[c]={exports:{}};e[c][0].call(u.exports,function(t){return r(e[c][1][t]||t)},u,u.exports,t,e,o,n)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({AudioManager:[function(t,e,o){"use strict";cc._RF.push(e,"ac898qrY6hBAa2tHR/P0zyo","AudioManager");var n=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,i=r.ccclass,c=(r.property,function(){function t(){}return t.prototype.playMusic=function(t,e){void 0===e&&(e=.5);var o="audio/music/"+t;cc.loader.loadRes(o,cc.AudioClip,function(t,o){t?console.error(t):(cc.audioEngine.setMusicVolume(e),cc.audioEngine.playMusic(o,!0))})},t.prototype.playSound=function(t,e){void 0===e&&(e=1);var o="audio/sound/"+t;cc.loader.loadRes(o,cc.AudioClip,function(t,o){t?console.error(t):(cc.audioEngine.setEffectsVolume(e),cc.audioEngine.playEffect(o,!1))})},t.NAME="AudioManager",t=n([i("AudioManager")],t)}());o.AudioManager=c,cc._RF.pop()},{}],BrokenPlatform:[function(t,e,o){"use strict";cc._RF.push(e,"2be66x8vUBNP4EVnbNqaNbI","BrokenPlatform");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./NormalPlatform"),c=t("./Singleton"),a=t("./PoolManager"),s=t("./AudioManager"),p=cc._decorator,u=p.ccclass,l=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isBroken=!1,e}return n(e,t),e.prototype.onEnable=function(){this.isBroken=!1;var t=this.getComponent(cc.Animation);t&&t.play("idle")},e.prototype.onDisable=function(){},e.prototype.onPlayerLanding=function(t){if(!this.isBroken){console.log("Do nothing");var e=this.getComponent(cc.Animation);e&&(e.play("broke",0),c.I(s.AudioManager).playSound("Explosions/explosion_15")),this.isBroken=!0}},e.prototype.onBrokenComplete=function(){c.I(a.default).setNode(this.node)},e=r([u],e)}(i.default));o.default=l,cc._RF.pop()},{"./AudioManager":"AudioManager","./NormalPlatform":"NormalPlatform","./PoolManager":"PoolManager","./Singleton":"Singleton"}],EventManager:[function(t,e,o){"use strict";cc._RF.push(e,"8b985b+wJJInYF4ZRH30BsK","EventManager");var n=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,i=r.ccclass,c=(r.property,function(){function t(){}return t.prototype.isMatch=function(t,e,o){return t===this.type&&e===this.callback&&o===this.thisArg},t}());o.EventData=c;var a=function(){function t(){this.eventMap={},this.caller2Events={}}return t.prototype.on=function(t,e,o){var n=this.eventMap[t];n||(n=this.eventMap[t]=[]);var r=new c;r.type=t,r.callback=e,r.thisArg=o,n.push(r)},t.prototype.off=function(t,e,o){var n=this.eventMap[t];if(n)for(var r=n.length-1;r>=0;--r){if(n[r].isMatch(t,e,o)){n.splice(r,1);break}}},t.prototype.dispatch=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n=this.eventMap[t];if(n)for(var r=0,i=n.length;r<i;++r){var c=n[r];c.callback.apply(c.thisArg,e)}},t.NAME="EventManager",t=n([i],t)}();o.default=a,cc._RF.pop()},{}],EventTypes:[function(t,e,o){"use strict";cc._RF.push(e,"1ff8aahAWtNW4DwhpDU17yr","EventTypes"),Object.defineProperty(o,"__esModule",{value:!0}),function(t){t[t.MSG_SET_SCORE=0]="MSG_SET_SCORE",t[t.MSG_RESTART=1]="MSG_RESTART",t[t.MSG_MOVE_RIGHT=2]="MSG_MOVE_RIGHT",t[t.MSG_MOVE_LEFT=3]="MSG_MOVE_LEFT",t[t.MSG_MOVE_UP=4]="MSG_MOVE_UP",t[t.MSG_STOP_LEFT=5]="MSG_STOP_LEFT",t[t.MSG_STOP_RIGHT=6]="MSG_STOP_RIGHT",t[t.MSG_STOP_UP=7]="MSG_STOP_UP"}(o.MsgEvt||(o.MsgEvt={})),cc._RF.pop()},{}],GameRoot:[function(t,e,o){"use strict";cc._RF.push(e,"c20ab7eZdZMiYkWvpWcDtKB","GameRoot");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,c=i.ccclass,a=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.player=null,e}return n(e,t),e.prototype.onLoad=function(){},e.prototype.update=function(t){},e.prototype.lateUpdate=function(t){},r([a({type:cc.Node})],e.prototype,"player",void 0),e=r([c],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],KeyboardHandler:[function(t,e,o){"use strict";cc._RF.push(e,"72418mvBERFzJAUTNuiYn1Y","KeyboardHandler");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./EventManager"),c=t("./Singleton"),a=t("./EventTypes"),s=cc._decorator,p=s.ccclass,u=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onEnable=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onDisable=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.a:c.I(i.default).dispatch(a.MsgEvt.MSG_MOVE_LEFT);break;case cc.macro.KEY.d:c.I(i.default).dispatch(a.MsgEvt.MSG_MOVE_RIGHT);break;case cc.macro.KEY.w:c.I(i.default).dispatch(a.MsgEvt.MSG_MOVE_UP)}},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.a:c.I(i.default).dispatch(a.MsgEvt.MSG_STOP_LEFT);break;case cc.macro.KEY.d:c.I(i.default).dispatch(a.MsgEvt.MSG_STOP_RIGHT);break;case cc.macro.KEY.w:c.I(i.default).dispatch(a.MsgEvt.MSG_STOP_UP)}},e=r([p],e)}(cc.Component));o.default=u,cc._RF.pop()},{"./EventManager":"EventManager","./EventTypes":"EventTypes","./Singleton":"Singleton"}],Main:[function(t,e,o){"use strict";cc._RF.push(e,"69e59yOP11KUa7teS11E3FB","Main");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,c=i.ccclass,a=(i.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onLoad=function(){cc.director.getCollisionManager().enabled=!0;cc.Canvas.instance.designResolution,cc.winSize},e.prototype.onDeviceMotion=function(t){},e=r([c],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],NormalPlatform:[function(t,e,o){"use strict";cc._RF.push(e,"2d0d7KdCt5CxKAxBJHhoJhC","NormalPlatform");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Platform"),c=cc._decorator,a=c.ccclass,s=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onPlayerLanding=function(t){t.applyJump()},e=r([a],e)}(i.default));o.default=s,cc._RF.pop()},{"./Platform":"Platform"}],PatrolPlatform:[function(t,e,o){"use strict";cc._RF.push(e,"cf360Au7N1Hr5tAhi6T0JCP","PatrolPlatform");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./NormalPlatform"),c=t("./Singleton"),a=t("./PoolManager"),s=cc._decorator,p=s.ccclass,u=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onEnable=function(){var t=this.getComponent(cc.Animation);t&&t.play("patrol")},e.prototype.lateUpdate=function(){this.node.convertToWorldSpaceAR(cc.v2()).y<0&&c.I(a.default).setNode(this.node.parent)},e=r([p],e)}(i.default));o.default=u,cc._RF.pop()},{"./NormalPlatform":"NormalPlatform","./PoolManager":"PoolManager","./Singleton":"Singleton"}],Patroller:[function(t,e,o){"use strict";cc._RF.push(e,"cd983CgeANDe5fJuUPRY1lF","Patroller");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,c=i.ccclass,a=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.begOffset=cc.v2(-50,0),e.endOffset=cc.v2(50,0),e.duration=1,e.time=0,e}return n(e,t),e.prototype.onLoad=function(){this.rigidBody=this.getComponent(cc.RigidBody),this.velocity=this.endOffset.sub(this.begOffset).div(this.duration)},e.prototype.update=function(t){this.time=(this.time+t)%(2*this.duration);var e=this.time<this.duration,o=this.rigidBody.linearVelocity;o=e?this.velocity.mul(1):this.velocity.mul(-1),this.rigidBody.linearVelocity=o},r([a],e.prototype,"begOffset",void 0),r([a],e.prototype,"endOffset",void 0),r([a],e.prototype,"duration",void 0),e=r([c],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],Platform:[function(t,e,o){"use strict";cc._RF.push(e,"6949cYN/C9PbqtXHNbex0PO","Platform");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Player"),c=t("./Singleton"),a=t("./PoolManager"),s=cc._decorator,p=s.ccclass,u=s.property,l=0,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.nameLabel=null,e.platformId=0,e}return n(e,t),e.prototype.onLoad=function(){this.platformId=++l,this.nameLabel&&(this.nameLabel.string=this.platformId.toString())},e.prototype.onEnable=function(){},e.prototype.lateUpdate=function(){this.node.convertToWorldSpaceAR(cc.v2()).y<0&&c.I(a.default).setNode(this.node)},e.prototype.onDisable=function(){},e.prototype.onCollisionEnter=function(t,e){var o=t.node.getComponent(i.default);if(o){var n=e.world.aabb,r=e.world.preAabb.clone(),c=t.world.aabb,a=t.world.preAabb.clone();a.x=c.x,r.x=n.x,a.y=c.y,r.y=n.y,cc.Intersection.rectRect(a,r)&&o.playerSpeed.y<0&&a.yMax>r.yMax&&this.onPlayerLanding(o)}},e.prototype.onPlayerLanding=function(t){},r([u({type:cc.Label})],e.prototype,"nameLabel",void 0),e=r([p],e)}(cc.Component);o.default=f,cc._RF.pop()},{"./Player":"Player","./PoolManager":"PoolManager","./Singleton":"Singleton"}],Player:[function(t,e,o){"use strict";cc._RF.push(e,"dcabbu1omRMo63JBJPnaDQH","Player");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i,c=t("./Singleton"),a=t("./PoolManager"),s=t("./AudioManager"),p=t("./EventManager"),u=t("./EventTypes"),l=cc._decorator,f=l.ccclass,h=l.property;(function(t){t[t.NONE=0]="NONE",t[t.LEFT=2]="LEFT",t[t.RIGHT=4]="RIGHT",t[t.CHARGE_JUMP=8]="CHARGE_JUMP"})(i||(i={}));var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rootNode=null,e.platformRoot=null,e.jumpSpeed=600,e.jumpMaxTimes=1,e.walkMaxSpeed=400,e.gravity=1e3,e.maxDownSpeed=1e3,e.moveDamp=150,e.keyDown={},e.leftJumpTimes=0,e.playerSpeed=cc.v2(),e.stopMoveOnceKeyUp=!0,e.isGameOver=!1,e.generateCurrY=0,e.generateAheadY=100,e.boardGapMin=50,e.boardGapMax=80,e.boardPrefabs=[],e.score=0,e.curAction=i.NONE,e}return n(e,t),e.prototype.onEnable=function(){c.I(p.default).on(u.MsgEvt.MSG_MOVE_LEFT,this.onMsgMoveLeft,this),c.I(p.default).on(u.MsgEvt.MSG_MOVE_RIGHT,this.onMsgMoveRight,this),c.I(p.default).on(u.MsgEvt.MSG_MOVE_UP,this.onMsgMoveUp,this),c.I(p.default).on(u.MsgEvt.MSG_STOP_LEFT,this.onMsgStopLeft,this),c.I(p.default).on(u.MsgEvt.MSG_STOP_RIGHT,this.onMsgStopRight,this),c.I(p.default).on(u.MsgEvt.MSG_STOP_UP,this.onMsgStopUp,this)},e.prototype.onMsgMoveLeft=function(){this.curAction|=i.LEFT},e.prototype.onMsgMoveRight=function(){this.curAction|=i.RIGHT},e.prototype.onMsgMoveUp=function(){this.curAction|=i.CHARGE_JUMP},e.prototype.onMsgStopLeft=function(){this.curAction&=~i.LEFT},e.prototype.onMsgStopRight=function(){this.curAction&=~i.RIGHT},e.prototype.onMsgStopUp=function(){this.curAction&=~i.CHARGE_JUMP},e.prototype.onDisable=function(){},e.prototype.onLoad=function(){this.playerOriginPos=this.node.getPosition().clone(),this.rootOriginPos=this.rootNode.getPosition().clone(),this.stageSize=cc.winSize},e.prototype.update=function(t){this.checkInput(),this.playMove(t),this.playJump(t),this.playFollow(t),this.generateBoard(),this.checkGameOver(),this.playerSpeed.x>0?this.playerSpeed.x=Math.max(0,this.playerSpeed.x-this.moveDamp*t):this.playerSpeed.x<0&&(this.playerSpeed.x=Math.min(0,this.playerSpeed.x+this.moveDamp*t))},e.prototype.checkInput=function(){if(this.isGameOver)this.getAction(i.CHARGE_JUMP)&&this.restart();else{var t=this.getAction(i.LEFT),e=this.getAction(i.RIGHT);this.getAction(i.CHARGE_JUMP);t?this.playerSpeed.x=-this.walkMaxSpeed:e?this.playerSpeed.x=this.walkMaxSpeed:this.stopMoveOnceKeyUp&&(this.playerSpeed.x=0)}},e.prototype.playJump=function(t){this.playerSpeed.y-=this.gravity*t,this.playerSpeed.y<-this.maxDownSpeed&&(this.playerSpeed.y=-this.maxDownSpeed)},e.prototype.playFollow=function(t){this.isGameOver?this.rootNode.setPosition(cc.v2(this.rootNode.position.x,this.rootNode.y-t*this.playerSpeed.y*2)):this.playerSpeed.y>0&&this.node.convertToWorldSpaceAR(cc.v2()).y>.5*this.stageSize.height&&(this.rootNode.setPosition(cc.v2(this.rootNode.position.x,this.rootNode.y-t*this.playerSpeed.y)),this.score=Math.floor(Math.max(this.score,-this.rootNode.position.y)),c.I(p.default).dispatch(u.MsgEvt.MSG_SET_SCORE,this.score))},e.prototype.playMove=function(t){this.node.setPosition(this.node.getPosition().addSelf(this.playerSpeed.mul(t))),this.node.position.x<0?this.node.setPosition(this.node.position.x+this.stageSize.width,this.node.position.y):this.node.position.x>this.stageSize.width&&this.node.setPosition(this.node.position.x-this.stageSize.width,this.node.position.y)},e.prototype.generateBoard=function(){if(!this.isGameOver)for(;this.generateCurrY<this.stageSize.height+this.generateAheadY-this.rootNode.y;){var t=this.boardPrefabs[Math.floor(Math.random()*this.boardPrefabs.length)],e=c.I(a.default).getNode(t,this.platformRoot),o=e.width/2+Math.floor(Math.random()*(this.stageSize.width-e.width)),n=Math.floor(Math.random()*(this.boardGapMax-this.boardGapMin)+this.boardGapMin);this.generateCurrY+=n,e.setPosition(o,this.generateCurrY)}},e.prototype.checkGameOver=function(){this.isGameOver||this.node.convertToWorldSpaceAR(cc.v2()).y<0&&(c.I(s.AudioManager).playSound("Game Over/game_over_25"),this.isGameOver=!0)},e.prototype.restart=function(){for(var t=this.platformRoot.children,e=t.length-1;e>=0;--e){var o=t[e];this.platformRoot.removeChild(o),c.I(a.default).setNode(o)}this.node.setPosition(this.playerOriginPos),this.rootNode.setPosition(this.rootOriginPos),this.isGameOver=!1,this.generateCurrY=0,this.score=0,c.I(p.default).dispatch(u.MsgEvt.MSG_RESTART)},e.prototype.lateUpdate=function(t){},e.prototype.applyJump=function(){var t=this.getAction(i.CHARGE_JUMP);this.playerSpeed.y=this.jumpSpeed*(t?2:1),c.I(s.AudioManager).playSound(t?"Jump/jump_04":"Jump/jump_03")},e.prototype.onBeginContact=function(t,e,o){console.log("onBeginContact");var n=t.getManifold();1==n.localNormal.y?t.disabled=!0:-1==n.localNormal.y&&(console.log("Ground"),this.leftJumpTimes=this.jumpMaxTimes)},e.prototype.onEndContact=function(t,e,o){console.log("onEndContact")},e.prototype.onPreSolve=function(t,e,o){},e.prototype.onPostSolve=function(t,e,o){},e.prototype.getAction=function(t){return this.curAction&t},r([h({type:cc.Node})],e.prototype,"rootNode",void 0),r([h({type:cc.Node})],e.prototype,"platformRoot",void 0),r([h({type:[cc.Prefab]})],e.prototype,"boardPrefabs",void 0),e=r([f],e)}(cc.Component);o.default=d,cc._RF.pop()},{"./AudioManager":"AudioManager","./EventManager":"EventManager","./EventTypes":"EventTypes","./PoolManager":"PoolManager","./Singleton":"Singleton"}],PoolManager:[function(t,e,o){"use strict";cc._RF.push(e,"6fc27W2odFK3Yk2SylPfmeS","PoolManager");var n=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,i=r.ccclass,c=(r.property,function(){function t(){this.nodePools={}}return t.prototype.getNode=function(t,e){void 0===e&&(e=null);var o,n=this.nodePools[t.name];return n&&0!=n.length?o=n.pop():(o=cc.instantiate(t)).name=t.name,e&&(o.parent=e),o.active=!0,o},t.prototype.setNode=function(t){var e=this.nodePools[t.name];e||(this.nodePools[t.name]=e=[]),t.parent=null,t.active=!1,e.push(t)},t.NAME="PoolManager",t=n([i],t)}());o.default=c,cc._RF.pop()},{}],Score:[function(t,e,o){"use strict";cc._RF.push(e,"d8fbejPWWJOyYju5BG8rigD","Score");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Singleton"),c=t("./EventManager"),a=t("./EventTypes"),s=cc._decorator,p=s.ccclass,u=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.score=null,e.currScore=0,e.showScore=0,e.deltaScore=500,e}return n(e,t),e.prototype.onEnable=function(){i.I(c.default).on(a.MsgEvt.MSG_SET_SCORE,this.setScore,this),i.I(c.default).on(a.MsgEvt.MSG_RESTART,this.onRestart,this)},e.prototype.onDisable=function(){i.I(c.default).off(a.MsgEvt.MSG_SET_SCORE,this.setScore,this)},e.prototype.onLoad=function(){this.reset()},e.prototype.update=function(t){if(this.showScore!=this.currScore){var e=this.currScore-this.showScore;if(e>0){var o=Math.min(e,Math.floor(t*this.deltaScore));this.showScore+=o}else{o=Math.max(e,-Math.floor(t*this.deltaScore));this.showScore+=o}this.updateScoreTxt()}},e.prototype.addScore=function(t){this.setScore(this.currScore+t)},e.prototype.setScore=function(t,e){void 0===e&&(e=!1),this.currScore=t,e&&(this.showScore=this.currScore,this.updateScoreTxt())},e.prototype.onRestart=function(){this.setScore(0,!0)},e.prototype.reset=function(){this.setScore(0,!0)},e.prototype.updateScoreTxt=function(){this.score&&(this.score.string=this.showScore.toString())},r([u(cc.Label)],e.prototype,"score",void 0),e=r([p],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./EventManager":"EventManager","./EventTypes":"EventTypes","./Singleton":"Singleton"}],ScrollBg:[function(t,e,o){"use strict";cc._RF.push(e,"b10491mfN9G7bkbaCAKOsu3","ScrollBg");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Singleton"),c=t("./PoolManager"),a=cc._decorator,s=a.ccclass,p=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.prefab=null,e.bgs=[],e.curMaxY=0,e.curMinY=0,e}return n(e,t),e.prototype.onLoad=function(){this.stageSize=cc.winSize,this.curMinY=0;for(var t=this.node.convertToWorldSpaceAR(cc.v2(0,this.stageSize.height)).y;this.curMaxY<t;){var e=i.I(c.default).getNode(this.prefab,this.node);this.bgs.push(e),e.y=this.curMaxY,this.curMaxY+=e.height}var o=i.I(c.default).getNode(this.prefab,this.node);this.bgs.push(o),o.y=this.curMaxY,this.curMaxY+=o.height},e.prototype.lateUpdate=function(t){for(;;){if(this.node.convertToWorldSpaceAR(cc.v2(0,this.curMaxY)).y>=this.stageSize.height)break;if(!(e=this.bgs.shift()))break;this.bgs.push(e),e.y=this.curMaxY,this.curMaxY+=e.height,this.curMinY+=e.height}for(;;){var e;if(this.node.convertToWorldSpaceAR(cc.v2(0,this.curMinY)).y<=0)break;if(!(e=this.bgs.pop()))break;this.bgs.unshift(e),e.y=this.curMinY-e.height,this.curMaxY-=e.height,this.curMinY-=e.height}},r([p(cc.Prefab)],e.prototype,"prefab",void 0),e=r([s],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./PoolManager":"PoolManager","./Singleton":"Singleton"}],Singleton:[function(t,e,o){"use strict";cc._RF.push(e,"d8140XEXjBNfYxDkyrLX3TD","Singleton");var n=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,i=r.ccclass,c=(r.property,function(){function t(){}return t.get=function(t,e,o){void 0===e&&(e=""),void 0===o&&(o=null);var n=o||t.NAME;n+=e;var r=this.allInst[n];return r||(r=this.allInst[n]=new t),r},t.allInst={},t=n([i],t)}());o.default=c,o.I=function(t,e,o){return void 0===e&&(e=""),void 0===o&&(o=null),c.get(t,e,o)},cc._RF.pop()},{}],TouchHandler:[function(t,e,o){"use strict";cc._RF.push(e,"7f3aesM/QpBnIpWlwdPCY4C","TouchHandler");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Singleton"),c=t("./EventManager"),a=t("./EventTypes"),s=cc._decorator,p=s.ccclass,u=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.leftBtn=null,e.rightBtn=null,e.jumpBtn=null,e}return n(e,t),e.prototype.onLoad=function(){this.leftBtn&&(this.leftBtn.on(cc.Node.EventType.TOUCH_START,this.moveLeft,this),this.leftBtn.on(cc.Node.EventType.TOUCH_CANCEL,this.stopLeft,this),this.leftBtn.on(cc.Node.EventType.TOUCH_END,this.stopLeft,this)),this.rightBtn&&(this.rightBtn.on(cc.Node.EventType.TOUCH_START,this.moveRight,this),this.rightBtn.on(cc.Node.EventType.TOUCH_CANCEL,this.stopRight,this),this.rightBtn.on(cc.Node.EventType.TOUCH_END,this.stopRight,this)),this.jumpBtn&&(this.jumpBtn.on(cc.Node.EventType.TOUCH_START,this.moveUp,this),this.jumpBtn.on(cc.Node.EventType.TOUCH_CANCEL,this.stopUp,this),this.jumpBtn.on(cc.Node.EventType.TOUCH_END,this.stopUp,this))},e.prototype.moveLeft=function(){i.I(c.default).dispatch(a.MsgEvt.MSG_MOVE_LEFT)},e.prototype.moveRight=function(){i.I(c.default).dispatch(a.MsgEvt.MSG_MOVE_RIGHT)},e.prototype.moveUp=function(){i.I(c.default).dispatch(a.MsgEvt.MSG_MOVE_UP)},e.prototype.stopLeft=function(){i.I(c.default).dispatch(a.MsgEvt.MSG_STOP_LEFT)},e.prototype.stopRight=function(){i.I(c.default).dispatch(a.MsgEvt.MSG_STOP_RIGHT)},e.prototype.stopUp=function(){i.I(c.default).dispatch(a.MsgEvt.MSG_STOP_UP)},r([u(cc.Node)],e.prototype,"leftBtn",void 0),r([u(cc.Node)],e.prototype,"rightBtn",void 0),r([u(cc.Node)],e.prototype,"jumpBtn",void 0),e=r([p],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./EventManager":"EventManager","./EventTypes":"EventTypes","./Singleton":"Singleton"}]},{},["AudioManager","BrokenPlatform","EventManager","EventTypes","GameRoot","KeyboardHandler","Main","NormalPlatform","PatrolPlatform","Patroller","Platform","Player","PoolManager","Score","ScrollBg","Singleton","TouchHandler"]);